<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.SVGPath?>

<ScrollPane fitToWidth="true" style="-fx-background-color: #fefbde; -fx-background: #fefbde;" 
            xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="marketplace.GUI.Controller.PaymentController">
   <content>
      <VBox spacing="25.0" style="-fx-background-color: #fefbde;">
         <padding>
            <Insets bottom="30.0" left="40.0" right="40.0" top="30.0" />
         </padding>
         <children>
            
            <!-- Header -->
            <HBox alignment="CENTER_LEFT" spacing="15.0">
               <children>
                  <Button onAction="#handleBack" style="-fx-background-color: transparent; -fx-cursor: hand;">
                     <graphic>
                        <SVGPath content="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" fill="#49ad32" scaleX="1.3" scaleY="1.3" />
                     </graphic>
                  </Button>
                  <SVGPath content="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="#49ad32" scaleX="1.5" scaleY="1.5" />
                  <Label style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #333;" text="Paiement" />
               </children>
            </HBox>
            
            <Separator />
            
            <!-- Main Content - Two Columns -->
            <HBox spacing="40.0" alignment="TOP_LEFT">
               
               <!-- Left Column: Order Summary -->
               <VBox spacing="20.0" prefWidth="500.0">
                  
                  <!-- Order Summary Card -->
                  <VBox spacing="15.0" style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 25; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                     <children>
                        <Label style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #333;" text="RÃ©sumÃ© de la commande" />
                        <Separator />
                        
                        <!-- Items list -->
                        <VBox fx:id="orderItemsContainer" spacing="12.0">
                           <!-- Order items will be added dynamically -->
                        </VBox>
                        
                        <Separator />
                        
                        <!-- Totals -->
                        <VBox spacing="8.0">
                           <HBox alignment="CENTER_LEFT">
                              <Label style="-fx-font-size: 14px; -fx-text-fill: #666;" text="Sous-total" />
                              <HBox HBox.hgrow="ALWAYS" />
                              <Label fx:id="subtotalLabel" style="-fx-font-size: 14px; -fx-text-fill: #333;" text="0.00 DT" />
                           </HBox>
                           
                           <HBox fx:id="cautionsRow" alignment="CENTER_LEFT" managed="false" visible="false">
                              <Label style="-fx-font-size: 14px; -fx-text-fill: #e67e22;" text="Cautions (remboursables)" />
                              <HBox HBox.hgrow="ALWAYS" />
                              <Label fx:id="cautionsLabel" style="-fx-font-size: 14px; -fx-text-fill: #e67e22;" text="0.00 DT" />
                           </HBox>
                           
                           <Separator />
                           
                           <HBox alignment="CENTER_LEFT">
                              <Label style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #333;" text="Total Ã  payer" />
                              <HBox HBox.hgrow="ALWAYS" />
                              <Label fx:id="totalLabel" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #49ad32;" text="0.00 DT" />
                           </HBox>
                        </VBox>
                     </children>
                  </VBox>
               </VBox>
               
               <!-- Right Column: Payment Form -->
               <VBox spacing="20.0" prefWidth="450.0" VBox.vgrow="ALWAYS">
                  
                  <!-- Shipping Address Card -->
                  <VBox spacing="15.0" style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 25; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                     <children>
                        <HBox spacing="10.0" alignment="CENTER_LEFT">
                           <SVGPath content="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="#49ad32" scaleX="1.2" scaleY="1.2" />
                           <Label style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #333;" text="Adresse de livraison" />
                        </HBox>
                        
                        <VBox spacing="10.0">
                           <Label style="-fx-font-size: 13px; -fx-text-fill: #666;" text="Adresse complÃ¨te *" />
                           <TextField fx:id="addressField" promptText="Entrez votre adresse" style="-fx-pref-height: 40; -fx-background-radius: 6; -fx-border-color: #ddd; -fx-border-radius: 6;" />
                           
                           <Label style="-fx-font-size: 13px; -fx-text-fill: #666;" text="Ville *" />
                           <HBox spacing="10.0">
                              <TextField fx:id="cityField" promptText="Ville" style="-fx-pref-height: 40; -fx-background-radius: 6; -fx-border-color: #ddd; -fx-border-radius: 6;" HBox.hgrow="ALWAYS" />
                              <Button onAction="#handleOpenMap" style="-fx-background-color: #49ad32; -fx-text-fill: white; -fx-font-size: 16px; -fx-pref-height: 40; -fx-pref-width: 50; -fx-background-radius: 6; -fx-cursor: hand;" text="ðŸ—ºï¸">
                                 <tooltip><Tooltip text="SÃ©lectionner l'adresse sur la carte" /></tooltip>
                              </Button>
                           </HBox>
                           
                           <Label style="-fx-font-size: 13px; -fx-text-fill: #666;" text="TÃ©lÃ©phone *" />
                           <TextField fx:id="phoneField" promptText="+216 XX XXX XXX" style="-fx-pref-height: 40; -fx-background-radius: 6; -fx-border-color: #ddd; -fx-border-radius: 6;" />
                        </VBox>
                     </children>
                  </VBox>
                  
                  <!-- Payment Method Card -->
                  <VBox spacing="15.0" style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 25; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 3);">
                     <children>
                        <HBox spacing="10.0" alignment="CENTER_LEFT">
                           <SVGPath content="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z" fill="#49ad32" scaleX="1.2" scaleY="1.2" />
                           <Label style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #333;" text="Paiement par carte" />
                           <HBox HBox.hgrow="ALWAYS" />
                           <SVGPath content="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.591-7.305z" fill="#6772e5" scaleX="1.0" scaleY="1.0" />
                        </HBox>
                        
                        <!-- Card form fields -->
                        <VBox spacing="12.0">
                           <!-- Card Holder Name -->
                           <VBox spacing="5.0">
                              <Label style="-fx-font-size: 13px; -fx-text-fill: #666;" text="Nom sur la carte" />
                              <TextField fx:id="cardHolderField" promptText="JEAN DUPONT" 
                                        style="-fx-pref-height: 45; -fx-background-radius: 6; -fx-border-color: #ddd; -fx-border-radius: 6; -fx-font-size: 14px;" />
                           </VBox>
                           
                           <!-- Card Number -->
                           <VBox spacing="5.0">
                              <HBox alignment="CENTER_LEFT" spacing="10.0">
                                 <Label style="-fx-font-size: 13px; -fx-text-fill: #666;" text="NumÃ©ro de carte *" />
                                 <HBox HBox.hgrow="ALWAYS" />
                                 <Label fx:id="cardBrandLabel" style="-fx-font-size: 12px; -fx-text-fill: #6772e5; -fx-font-weight: bold;" text="" />
                              </HBox>
                              <TextField fx:id="cardNumberField" promptText="4242 4242 4242 4242" 
                                        style="-fx-pref-height: 45; -fx-background-radius: 6; -fx-border-color: #ddd; -fx-border-radius: 6; -fx-font-size: 16px; -fx-font-family: monospace;" />
                           </VBox>
                           
                           <!-- Expiry and CVC in same row -->
                           <HBox spacing="15.0">
                              <VBox spacing="5.0" HBox.hgrow="ALWAYS">
                                 <Label style="-fx-font-size: 13px; -fx-text-fill: #666;" text="Date d'expiration *" />
                                 <TextField fx:id="expiryField" promptText="MM/YY" 
                                           style="-fx-pref-height: 45; -fx-background-radius: 6; -fx-border-color: #ddd; -fx-border-radius: 6; -fx-font-size: 14px; -fx-font-family: monospace;" />
                              </VBox>
                              <VBox spacing="5.0" prefWidth="120.0">
                                 <Label style="-fx-font-size: 13px; -fx-text-fill: #666;" text="CVC *" />
                                 <TextField fx:id="cvcField" promptText="123" 
                                           style="-fx-pref-height: 45; -fx-background-radius: 6; -fx-border-color: #ddd; -fx-border-radius: 6; -fx-font-size: 14px; -fx-font-family: monospace;" />
                              </VBox>
                           </HBox>
                        </VBox>
                        
                        <!-- Test mode notice -->
                        <HBox spacing="8.0" alignment="CENTER" style="-fx-background-color: #fff3cd; -fx-background-radius: 6; -fx-padding: 10;">
                           <SVGPath content="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="#856404" scaleX="0.8" scaleY="0.8" />
                           <Label style="-fx-font-size: 11px; -fx-text-fill: #856404;" text="Mode test - Utilisez 4242 4242 4242 4242 pour tester" wrapText="true" />
                        </HBox>
                     </children>
                  </VBox>
                  
                  <!-- Pay Button -->
                  <Button fx:id="confirmPayButton" maxWidth="Infinity" onAction="#handleConfirmPayment" 
                          prefHeight="55.0" 
                          style="-fx-background-color: #49ad32; -fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold; -fx-background-radius: 10; -fx-cursor: hand; -fx-effect: dropshadow(three-pass-box, rgba(73,173,50,0.4), 10, 0, 0, 3);"
                          text="Payer maintenant">
                     <graphic>
                        <SVGPath content="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" fill="white" scaleX="1.2" scaleY="1.2" />
                     </graphic>
                  </Button>
                  
                  <!-- Security note -->
                  <HBox spacing="8.0" alignment="CENTER">
                     <SVGPath content="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" fill="#888" scaleX="0.9" scaleY="0.9" />
                     <Label style="-fx-font-size: 11px; -fx-text-fill: #888;" text="Vos informations sont sÃ©curisÃ©es et cryptÃ©es" />
                  </HBox>
                  
               </VBox>
            </HBox>
            
         </children>
      </VBox>
   </content>
</ScrollPane>
