<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.SVGPath?>

<StackPane fx:id="rootPane" prefHeight="720.0" prefWidth="1280.0" stylesheets="@../css/styles.css" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="marketplace.GUI.Controller.ClientDashboardController">
   <children>
      <!-- Main BorderPane -->
      <BorderPane fx:id="mainBorderPane" prefHeight="720.0" prefWidth="1280.0">
         <left>
            <VBox prefHeight="720.0" prefWidth="200.0" spacing="5.0" styleClass="sidebar" BorderPane.alignment="CENTER">
               <children>
                  <!-- Logo Section -->
                  <VBox alignment="CENTER" prefHeight="180.0" prefWidth="200.0">
                     <children>
                        <ImageView fx:id="logoImageView" fitHeight="150.0" fitWidth="150.0" pickOnBounds="true" preserveRatio="true" />
                     </children>
                     <padding>
                        <Insets top="20.0" />
                     </padding>
                  </VBox>
            
            <!-- Navigation Buttons -->
            <Button fx:id="btnAccueil" mnemonicParsing="false" onAction="#handleAccueil" prefHeight="50.0" prefWidth="200.0" styleClass="sidebar-button">
               <graphic>
                  <HBox alignment="CENTER_LEFT" spacing="10.0" prefWidth="180.0">
                     <children>
                        <Label fx:id="lblAccueil" text="Accueil" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #49ad32;">
                           <HBox.margin>
                              <Insets left="15.0" />
                           </HBox.margin>
                        </Label>
                        <HBox HBox.hgrow="ALWAYS" />
                        <SVGPath fx:id="iconAccueil" content="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" fill="#49ad32" scaleX="1.2" scaleY="1.2">
                           <HBox.margin>
                              <Insets right="15.0" />
                           </HBox.margin>
                        </SVGPath>
                     </children>
                  </HBox>
               </graphic>
               <VBox.margin>
                  <Insets bottom="5.0" />
               </VBox.margin>
            </Button>
            
            <Button fx:id="btnProfil" mnemonicParsing="false" onAction="#handleProfil" prefHeight="50.0" prefWidth="200.0" styleClass="sidebar-button">
               <graphic>
                  <HBox alignment="CENTER_LEFT" spacing="10.0" prefWidth="180.0">
                     <children>
                        <Label fx:id="lblProfil" text="Profil" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #49ad32;">
                           <HBox.margin>
                              <Insets left="15.0" />
                           </HBox.margin>
                        </Label>
                        <HBox HBox.hgrow="ALWAYS" />
                        <SVGPath fx:id="iconProfil" content="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="#49ad32" scaleX="1.1" scaleY="1.1">
                           <HBox.margin>
                              <Insets right="15.0" />
                           </HBox.margin>
                        </SVGPath>
                     </children>
                  </HBox>
               </graphic>
               <VBox.margin>
                  <Insets bottom="5.0" />
               </VBox.margin>
            </Button>
            
            <Button fx:id="btnForum" mnemonicParsing="false" onAction="#handleForum" prefHeight="50.0" prefWidth="200.0" styleClass="sidebar-button">
               <graphic>
                  <HBox alignment="CENTER_LEFT" spacing="10.0" prefWidth="180.0">
                     <children>
                        <Label fx:id="lblForum" text="Forum" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #49ad32;">
                           <HBox.margin>
                              <Insets left="15.0" />
                           </HBox.margin>
                        </Label>
                        <HBox HBox.hgrow="ALWAYS" />
                        <SVGPath fx:id="iconForum" content="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z" fill="#49ad32" scaleX="1.1" scaleY="1.1">
                           <HBox.margin>
                              <Insets right="15.0" />
                           </HBox.margin>
                        </SVGPath>
                     </children>
                  </HBox>
               </graphic>
               <VBox.margin>
                  <Insets bottom="5.0" />
               </VBox.margin>
            </Button>
            
            <Button fx:id="btnEvenement" mnemonicParsing="false" onAction="#handleEvenement" prefHeight="50.0" prefWidth="200.0" styleClass="sidebar-button">
               <graphic>
                  <HBox alignment="CENTER_LEFT" spacing="10.0" prefWidth="180.0">
                     <children>
                        <Label fx:id="lblEvenement" text="Évènement" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #49ad32; -fx-min-width: 80;">
                           <HBox.margin>
                              <Insets left="15.0" />
                           </HBox.margin>
                        </Label>
                        <HBox HBox.hgrow="ALWAYS" />
                        <SVGPath fx:id="iconEvenement" content="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z" fill="#49ad32" scaleX="1.1" scaleY="1.1">
                           <HBox.margin>
                              <Insets right="15.0" />
                           </HBox.margin>
                        </SVGPath>
                     </children>
                  </HBox>
               </graphic>
               <VBox.margin>
                  <Insets bottom="5.0" />
               </VBox.margin>
            </Button>
            
            <Button fx:id="btnTechnicien" mnemonicParsing="false" onAction="#handleTechnicien" prefHeight="50.0" prefWidth="200.0" styleClass="sidebar-button">
               <graphic>
                  <HBox alignment="CENTER_LEFT" spacing="10.0" prefWidth="180.0">
                     <children>
                        <Label fx:id="lblTechnicien" text="Technicien" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #49ad32; -fx-min-width: 80;">
                           <HBox.margin>
                              <Insets left="15.0" />
                           </HBox.margin>
                        </Label>
                        <HBox HBox.hgrow="ALWAYS" />
                        <SVGPath fx:id="iconTechnicien" content="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z" fill="#49ad32" scaleX="1.0" scaleY="1.0">
                           <HBox.margin>
                              <Insets right="15.0" />
                           </HBox.margin>
                        </SVGPath>
                     </children>
                  </HBox>
               </graphic>
               <VBox.margin>
                  <Insets bottom="5.0" />
               </VBox.margin>
            </Button>
            
            <Button fx:id="btnMarketplace" mnemonicParsing="false" onAction="#handleMarketplace" prefHeight="50.0" prefWidth="200.0" styleClass="sidebar-button">
               <graphic>
                  <HBox alignment="CENTER_LEFT" spacing="10.0" prefWidth="180.0">
                     <children>
                        <Label fx:id="lblMarketplace" text="Marketplace" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #49ad32; -fx-min-width: 85;">
                           <HBox.margin>
                              <Insets left="15.0" />
                           </HBox.margin>
                        </Label>
                        <HBox HBox.hgrow="ALWAYS" />
                        <SVGPath fx:id="iconMarketplace" content="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" fill="#49ad32" scaleX="1.0" scaleY="1.0">
                           <HBox.margin>
                              <Insets right="15.0" />
                           </HBox.margin>
                        </SVGPath>
                     </children>
                  </HBox>
               </graphic>
               <VBox.margin>
                  <Insets bottom="5.0" />
               </VBox.margin>
            </Button>
            
            <!-- Spacer to push disconnect button to bottom -->
            <VBox VBox.vgrow="ALWAYS" />
            
            <!-- Disconnect Button -->
            <Button fx:id="btnDeconnecter" mnemonicParsing="false" onAction="#handleDeconnecter" prefHeight="50.0" prefWidth="200.0" styleClass="sidebar-button">
               <graphic>
                  <HBox alignment="CENTER_LEFT" spacing="10.0" prefWidth="180.0">
                     <children>
                        <Label fx:id="lblDeconnecter" text="Déconnexion" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #49ad32; -fx-min-width: 85;">
                           <HBox.margin>
                              <Insets left="15.0" />
                           </HBox.margin>
                        </Label>
                        <HBox HBox.hgrow="ALWAYS" />
                        <SVGPath fx:id="iconDeconnecter" content="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" fill="#49ad32" scaleX="1.0" scaleY="1.0">
                           <HBox.margin>
                              <Insets right="15.0" />
                           </HBox.margin>
                        </SVGPath>
                     </children>
                  </HBox>
               </graphic>
               <VBox.margin>
                  <Insets bottom="20.0" />
               </VBox.margin>
            </Button>
               </children>
            </VBox>
         </left>
         <center>
            <VBox style="-fx-background-color: #fefbde;">
               <!-- Top Bar with Cart and Rentals Icons -->
               <HBox alignment="CENTER_RIGHT" spacing="15" style="-fx-background-color: #fefbde; -fx-padding: 10 20 0 20;">
                  <children>
                     <!-- Rentals Button -->
                     <Button fx:id="btnRentals" onAction="#handleToggleRentals" style="-fx-background-color: white; -fx-background-radius: 50; -fx-min-width: 50; -fx-min-height: 50; -fx-max-width: 50; -fx-max-height: 50; -fx-cursor: hand; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.15), 8, 0, 0, 2);">
                        <graphic>
                           <StackPane>
                              <children>
                                 <!-- Calendar/Bookmark icon for rentals -->
                                 <SVGPath content="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z" fill="#e67e22" scaleX="1.3" scaleY="1.3" />
                              </children>
                           </StackPane>
                        </graphic>
                     </Button>
                     <!-- Cart Button -->
                     <Button fx:id="btnCart" onAction="#handleToggleCart" style="-fx-background-color: white; -fx-background-radius: 50; -fx-min-width: 50; -fx-min-height: 50; -fx-max-width: 50; -fx-max-height: 50; -fx-cursor: hand; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.15), 8, 0, 0, 2);">
                        <graphic>
                           <StackPane>
                              <children>
                                 <SVGPath content="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" fill="#49ad32" scaleX="1.3" scaleY="1.3" />
                                 <!-- Cart Badge -->
                                 <Label fx:id="cartBadge" alignment="CENTER" 
                                        style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-size: 10px; -fx-font-weight: bold; -fx-min-width: 18; -fx-min-height: 18; -fx-background-radius: 10; -fx-padding: 0;"
                                        text="0" visible="false" managed="false"
                                        StackPane.alignment="TOP_RIGHT">
                                    <StackPane.margin>
                                       <Insets top="-5.0" right="-5.0" />
                                    </StackPane.margin>
                                 </Label>
                              </children>
                           </StackPane>
                        </graphic>
                     </Button>
                  </children>
               </HBox>
               
               <!-- Content Area -->
               <StackPane fx:id="contentArea" VBox.vgrow="ALWAYS" style="-fx-background-color: #fefbde;">
                  <padding>
                     <Insets bottom="20.0" left="20.0" right="20.0" top="10.0" />
                  </padding>
               </StackPane>
            </VBox>
         </center>
      </BorderPane>
      
      <!-- Cart Panel Overlay (initially hidden) -->
      <HBox fx:id="cartOverlay" alignment="CENTER_RIGHT" visible="false" managed="false" 
            style="-fx-background-color: rgba(0,0,0,0.3);" mouseTransparent="false">
         <children>
            <!-- Cart panel will be loaded dynamically here -->
            <VBox fx:id="cartPanelContainer" prefWidth="350.0" />
         </children>
      </HBox>
      
      <!-- Rentals Panel Overlay (initially hidden) -->
      <HBox fx:id="rentalsOverlay" alignment="CENTER_RIGHT" visible="false" managed="false" 
            style="-fx-background-color: rgba(0,0,0,0.3);" mouseTransparent="false">
         <children>
            <!-- Rentals panel will be loaded dynamically here -->
            <VBox fx:id="rentalsPanelContainer" prefWidth="380.0" />
         </children>
      </HBox>
   </children>
</StackPane>
